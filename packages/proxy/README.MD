# ğŸ›¡ï¸ Proxy - NoteConnect

## ğŸ” PrÃ©sentation

Le proxy de **NoteConnect** est un serveur **HTTPS** dÃ©veloppÃ© avec **Express** et **http-proxy-middleware**.
Il Ã©tait conÃ§u pour rediriger les requÃªtes vers le backend, gÃ©rer le CORS et sÃ©curiser les communications, mais il est actuellement remplacÃ© par **Nginx**.

Le proxy inclut :

* Gestion des **origines autorisÃ©es (CORS)**
* Redirection des requÃªtes vers le backend (`/proxy/*`)
* RÃ©Ã©criture des chemins et en-tÃªtes (`x-forwarded-proto`)
* Gestion des erreurs et des rÃ©ponses uniformisÃ©es

---

## ğŸ—ï¸ Structure du projet

```
packages/proxy/
â”œâ”€â”€ config/         # Configuration du proxy (ports, certificats, origines)
â”œâ”€â”€ server.js       # Serveur principal du proxy
â”œâ”€â”€ package.json    # DÃ©pendances et scripts
â””â”€â”€ README.md
```

---

## ğŸš€ Installation et exÃ©cution

### PrÃ©requis

* Node.js >=16
* npm >=8
* Certificats HTTPS valides

### Installation

```sh
npm install
```

### Lancer le serveur proxy

```sh
npm run start
```

Le proxy Ã©coute par dÃ©faut sur le port configurÃ© dans `config.PROXY_PORT` et expose un endpoint de test :

```
GET /status  => 'Proxy is running'
```

---

## âš™ï¸ FonctionnalitÃ©s principales

* Redirection des requÃªtes `/proxy/*` vers le backend
* Gestion des CORS avec liste dâ€™origines autorisÃ©es (`config.ALLOWED_ORIGINS`)
* RÃ©Ã©criture des chemins (`^/proxy` â†’ ``)
* SÃ©curisation HTTPS via `key` et `cert`
* Gestion centralisÃ©e des erreurs via `errorHandler` et `CustomError`
* Ajout de lâ€™en-tÃªte `x-forwarded-proto: https` pour signaler le protocole

---

## ğŸ› ï¸ DÃ©pendances

* `express` : serveur HTTP
* `http-proxy-middleware` : redirection des requÃªtes
* `cors` : gestion des origines autorisÃ©es
* `https` / `fs` : serveur HTTPS
* `@noteconnect/utils` : Logger, CustomError, errorHandler

---

## ğŸ’¡ Notes

* Actuellement remplacÃ© par **Nginx** pour la production.
* Le proxy peut encore Ãªtre utile pour des environnements de test ou si Nginx nâ€™est pas disponible.

---